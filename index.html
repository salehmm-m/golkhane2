<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ماشین‌حساب مصرف کود و مواد مغذی گلخانه</title>

  <style>
    body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
            direction: rtl;
            text-align: right;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
        }
        .form-section {
            background-color: #e6ffe6; /* سبز روشن */
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 25px;
            border: 1px solid #d4edda;
        }
        .form-section h3 {
            color: #28a745;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: right;
            border-bottom: 1px dashed #a3e2b2;
            padding-bottom: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"],
        input[type="text"], /* برای نام کود */
        select {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            text-align: left; /* برای نمایش بهتر اعداد */
            direction: ltr; /* برای نمایش بهتر اعداد */
        }
        button {
            background-color: #ff8c00; /* نارنجی تیره */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #cc7000;
        }
        .results, .suggestions {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff8e1; /* زرد خیلی روشن */
            border: 1px solid #ffe0b2;
            border-radius: 5px;
        }
        .results p, .suggestions p, .suggestions ul {
            margin-bottom: 10px;
            line-height: 1.6;
            text-align: justify;
        }
        .results strong {
            color: #e65100; /* نارنجی تیره تر */
        }
        .suggestions strong {
            color: #28a745;
        }
        .note {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: justify;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .result-table th, .result-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        .result-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #333;
        }
  </style>

  
</head>
<body>
  <div class="container">
        <h1>ماشین‌حساب مصرف کود و مواد مغذی گلخانه</h1>

        <form id="nutrientCalculatorForm">
            <div class="form-section">
                <h3>الف) اطلاعات کلی</h3>
                <div class="form-group">
                    <label for="cropType">نوع محصول:</label>
                    <select id="cropType" name="cropType" required>
                        <option value="">انتخاب کنید...</option>
                        <option value="tomato">گوجه فرنگی</option>
                        <option value="cucumber">خیار</option>
                        <option value="bell_pepper">فلفل دلمه‌ای</option>
                        <option value="strawberry">توت فرنگی</option>
                        <option value="other">سایر</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="growthStage">مرحله رشد گیاه:</label>
                    <select id="growthStage" name="growthStage" required>
                        <option value="">انتخاب کنید...</option>
                        <option value="seedling">نشا</option>
                        <option value="vegetative">رشد رویشی</option>
                        <option value="flowering">گلدهی</option>
                        <option value="fruiting">باردهی</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="solutionVolume">حجم مخزن کود (لیتر) یا مساحت (متر مربع):</label>
                    <input type="number" id="solutionVolume" name="solutionVolume" min="1" placeholder="مثال: 1000 (لیتر) یا 100 (متر مربع)" required>
                    <p class="note">اگر بر اساس حجم مخزن محاسبه می‌کنید، مقدار را به لیتر وارد کنید. اگر بر اساس مساحت، به متر مربع.</p>
                </div>
                <div class="form-group">
                    <label for="calculationUnit">واحد محاسبه:</label>
                    <select id="calculationUnit" name="calculationUnit" required>
                        <option value="volume">حجم مخزن (لیتر)</option>
                        <option value="area">مساحت کشت (متر مربع)</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <h3>ب) نیاز گیاه به عناصر (ppm)</h3>
                <p class="note">این مقادیر را می‌توانید از جداول توصیه‌های کودی برای محصول و مرحله رشد خود به دست آورید.</p>
                <div class="form-group">
                    <label for="reqN">نیتروژن (N) - ppm:</label>
                    <input type="number" id="reqN" name="reqN" min="0" placeholder="مثال: 180" required>
                </div>
                <div class="form-group">
                    <label for="reqP">فسفر (P) - ppm:</label>
                    <input type="number" id="reqP" name="reqP" min="0" placeholder="مثال: 40" required>
                </div>
                <div class="form-group">
                    <label for="reqK">پتاسیم (K) - ppm:</label>
                    <input type="number" id="reqK" name="reqK" min="0" placeholder="مثال: 200" required>
                </div>
                <div class="form-group">
                    <label for="reqCa">کلسیم (Ca) - ppm:</label>
                    <input type="number" id="reqCa" name="reqCa" min="0" placeholder="مثال: 150">
                </div>
                <div class="form-group">
                    <label for="reqMg">منیزیم (Mg) - ppm:</label>
                    <input type="number" id="reqMg" name="reqMg" min="0" placeholder="مثال: 50">
                </div>
            </div>

            <div class="form-section">
                <h3>ج) غلظت عناصر موجود در آب آبیاری (ppm)</h3>
                <p class="note">این مقادیر را از آنالیز آب مزرعه خود وارد کنید. اگر اطلاعاتی ندارید، صفر وارد کنید.</p>
                <div class="form-group">
                    <label for="waterN">نیتروژن (N) در آب: ppm</label>
                    <input type="number" id="waterN" name="waterN" min="0" placeholder="مثال: 5">
                </div>
                <div class="form-group">
                    <label for="waterP">فسفر (P) در آب: ppm</label>
                    <input type="number" id="waterP" name="waterP" min="0" placeholder="مثال: 2">
                </div>
                <div class="form-group">
                    <label for="waterK">پتاسیم (K) در آب: ppm</label>
                    <input type="number" id="waterK" name="waterK" min="0" placeholder="مثال: 10">
                </div>
                <div class="form-group">
                    <label for="waterCa">کلسیم (Ca) در آب: ppm</label>
                    <input type="number" id="waterCa" name="waterCa" min="0" placeholder="مثال: 80">
                </div>
                <div class="form-group">
                    <label for="waterMg">منیزیم (Mg) در آب: ppm</label>
                    <input type="number" id="waterMg" name="waterMg" min="0" placeholder="مثال: 20">
                </div>
            </div>

            <div class="form-section">
                <h3>د) کودهای در دسترس (درصد عنصر خالص)</h3>
                <p class="note">درصد عنصر خالص در کود را وارد کنید (مثال: نیترات پتاسیم حاوی 13% N و 46% K).</p>
                <div class="form-group">
                    <label for="fert1Name">نام کود ۱ (مثال: نیترات پتاسیم):</label>
                    <input type="text" id="fert1Name" name="fert1Name" placeholder="کود ۱" value="نیترات پتاسیم">
                </div>
                <div class="form-group">
                    <label for="fert1N">درصد نیتروژن (N) در کود ۱ (%):</label>
                    <input type="number" id="fert1N" name="fert1N" step="0.1" min="0" max="100" placeholder="مثال: 13.0">
                    <label for="fert1P">درصد فسفر (P) در کود ۱ (%):</label>
                    <input type="number" id="fert1P" name="fert1P" step="0.1" min="0" max="100" placeholder="مثال: 0.0">
                    <label for="fert1K">درصد پتاسیم (K) در کود ۱ (%):</label>
                    <input type="number" id="fert1K" name="fert1K" step="0.1" min="0" max="100" placeholder="مثال: 46.0">
                </div>

                <div class="form-group">
                    <label for="fert2Name">نام کود ۲ (مثال: نیترات کلسیم):</label>
                    <input type="text" id="fert2Name" name="fert2Name" placeholder="کود ۲" value="نیترات کلسیم">
                </div>
                <div class="form-group">
                    <label for="fert2N">درصد نیتروژن (N) در کود ۲ (%):</label>
                    <input type="number" id="fert2N" name="fert2N" step="0.1" min="0" max="100" placeholder="مثال: 15.5">
                    <label for="fert2P">درصد فسفر (P) در کود ۲ (%):</label>
                    <input type="number" id="fert2P" name="fert2P" step="0.1" min="0" max="100" placeholder="مثال: 0.0">
                    <label for="fert2K">درصد پتاسیم (K) در کود ۲ (%):</label>
                    <input type="number" id="fert2K" name="fert2K" step="0.1" min="0" max="100" placeholder="مثال: 0.0">
                    <label for="fert2Ca">درصد کلسیم (Ca) در کود ۲ (%):</label>
                    <input type="number" id="fert2Ca" name="fert2Ca" step="0.1" min="0" max="100" placeholder="مثال: 19.0">
                </div>
                </div>

            <button type="submit">محاسبه میزان کود</button>
        </form>

        <div class="results" id="nutrientResults">
            <h2>نتایج محاسبه کود مورد نیاز</h2>
            <p><strong>محصول:</strong> <span id="displayCropType">--</span> - <strong>مرحله رشد:</strong> <span id="displayGrowthStage">--</span></p>
            <p><strong>واحد محاسبه:</strong> <span id="displayCalculationUnit">--</span></p>

            <table class="result-table">
                <thead>
                    <tr>
                        <th>عنصر</th>
                        <th>نیاز خالص (ppm)</th>
                        <th>موجود در آب (ppm)</th>
                        <th>نیاز نهایی از کود (ppm)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>نیتروژن (N)</td>
                        <td id="resNReq">--</td>
                        <td id="resNWater">--</td>
                        <td id="resNFinal">--</td>
                    </tr>
                    <tr>
                        <td>فسفر (P)</td>
                        <td id="resPReq">--</td>
                        <td id="resPWater">--</td>
                        <td id="resPFinal">--</td>
                    </tr>
                    <tr>
                        <td>پتاسیم (K)</td>
                        <td id="resKReq">--</td>
                        <td id="resKWater">--</td>
                        <td id="resKFinal">--</td>
                    </tr>
                     <tr>
                        <td>کلسیم (Ca)</td>
                        <td id="resCaReq">--</td>
                        <td id="resCaWater">--</td>
                        <td id="resCaFinal">--</td>
                    </tr>
                     <tr>
                        <td>منیزیم (Mg)</td>
                        <td id="resMgReq">--</td>
                        <td id="resMgWater">--</td>
                        <td id="resMgFinal">--</td>
                    </tr>
                </tbody>
            </table>

            <h3>میزان کودهای پیشنهادی برای <span id="displaySolutionVolume">--</span> <span id="displayUnitText">--</span></h3>
            <p id="fert1Dosage">**کود ۱ (نامشخص):** -- گرم</p>
            <p id="fert2Dosage">**کود ۲ (نامشخص):** -- گرم</p>
            <p class="note">این محاسبات یک تخمین اولیه هستند. برای دقت بیشتر، باید آنالیز دقیق‌تر آب و خاک، pH محلول غذایی، و اثرات متقابل عناصر را در نظر بگیرید. همیشه قبل از استفاده گسترده، آزمایش‌های کوچک انجام دهید.</p>
        </div>

        <div class="suggestions" id="nutrientSuggestions">
            <h2>توضیحات و پیشنهادات مهم</h2>
            <h3>اهمیت تغذیه دقیق در گلخانه:</h3>
            <ul>
                <li>**حداکثر عملکرد:** تغذیه متعادل و دقیق باعث رشد بهینه گیاه و افزایش عملکرد و کیفیت محصول می‌شود.</li>
                <li>**کاهش هزینه‌ها:** جلوگیری از مصرف بی‌رویه کود و هدررفت آن.</li>
                <li>**سلامت گیاه:** پیشگیری از کمبودها یا مسمومیت‌های غذایی که می‌توانند منجر به بیماری و کاهش تولید شوند.</li>
                <li>**حفاظت از محیط زیست:** کاهش رواناب کودها به منابع آب و خاک.</li>
            </ul>

            <h3>پیشنهادات برای تغذیه بهینه:</h3>
            <ul>
                <li><strong>آزمایش آب و خاک:</strong> این مهمترین قدم است! ترکیب آب آبیاری شما (بخصوص از نظر کلسیم، منیزیم، سدیم و کلر) و وضعیت خاک (اگر کشت خاکی دارید) بسیار بر نیاز کودی تاثیر می‌گذارد.</li>
                <li><strong>کیفیت کودها:</strong> استفاده از کودهای با گرید بالا و حلالیت کامل که برای سیستم‌های هیدروپونیک یا آبیاری قطره‌ای مناسب باشند.</li>
                <li><strong>تنظیم pH:</strong> pH محلول غذایی بر جذب عناصر توسط ریشه تأثیر مستقیم دارد. بیشتر گیاهان در pH 5.5 تا 6.5 بهترین جذب را دارند.</li>
                <li><strong>EC (هدایت الکتریکی):</strong> پایش مداوم EC محلول غذایی برای اطمینان از غلظت مناسب نمک‌ها. افزایش بیش از حد EC می‌تواند منجر به سوختگی ریشه شود.</li>
                <li><strong>پایش گیاه:</strong> مشاهده دقیق علائم کمبود یا مسمومیت در برگ‌ها و ساقه‌ها.</li>
                <li><strong>برنامه‌ریزی فصلی:</strong> نیاز کودی گیاه با تغییر فصل (شدت نور، دما) و مرحله رشد آن تغییر می‌کند.</li>
                <li><strong>بافرها:</strong> استفاده از ترکیبات بافر در محلول غذایی برای حفظ پایداری pH.</li>
            </ul>

            <p class="note">همواره با متخصصین تغذیه گیاهی و کارشناسان کشاورزی مشورت کنید تا برنامه‌های کودی متناسب با شرایط خاص گلخانه شما طراحی شود.</p>
        </div>
    </div>

  <script>
    document.getElementById('nutrientCalculatorForm').addEventListener('submit', function(event) {
            event.preventDefault();

            // گرفتن مقادیر ورودی
            const cropType = document.getElementById('cropType').options[document.getElementById('cropType').selectedIndex].text;
            const growthStage = document.getElementById('growthStage').options[document.getElementById('growthStage').selectedIndex].text;
            const solutionVolume = parseFloat(document.getElementById('solutionVolume').value);
            const calculationUnit = document.getElementById('calculationUnit').value;
            const calculationUnitDisplayName = document.getElementById('calculationUnit').options[document.getElementById('calculationUnit').selectedIndex].text;

            // نیاز گیاه
            const reqN = parseFloat(document.getElementById('reqN').value);
            const reqP = parseFloat(document.getElementById('reqP').value);
            const reqK = parseFloat(document.getElementById('reqK').value);
            const reqCa = parseFloat(document.getElementById('reqCa').value) || 0;
            const reqMg = parseFloat(document.getElementById('reqMg').value) || 0;

            // عناصر موجود در آب آبیاری
            const waterN = parseFloat(document.getElementById('waterN').value) || 0;
            const waterP = parseFloat(document.getElementById('waterP').value) || 0;
            const waterK = parseFloat(document.getElementById('waterK').value) || 0;
            const waterCa = parseFloat(document.getElementById('waterCa').value) || 0;
            const waterMg = parseFloat(document.getElementById('waterMg').value) || 0;

            // کودهای در دسترس
            const fert1Name = document.getElementById('fert1Name').value || 'کود ۱';
            const fert1N = parseFloat(document.getElementById('fert1N').value) || 0;
            const fert1P = parseFloat(document.getElementById('fert1P').value) || 0;
            const fert1K = parseFloat(document.getElementById('fert1K').value) || 0;

            const fert2Name = document.getElementById('fert2Name').value || 'کود ۲';
            const fert2N = parseFloat(document.getElementById('fert2N').value) || 0;
            const fert2P = parseFloat(document.getElementById('fert2P').value) || 0;
            const fert2K = parseFloat(document.getElementById('fert2K').value) || 0;
            const fert2Ca = parseFloat(document.getElementById('fert2Ca').value) || 0;

            // اعتبارسنجی اولیه
            if (isNaN(solutionVolume) || isNaN(reqN) || isNaN(reqP) || isNaN(reqK) ||
                solutionVolume <= 0 || reqN <= 0 || reqP <= 0 || reqK <= 0) {
                alert('لطفاً همه فیلدهای ضروری (حجم/مساحت و نیازهای N, P, K گیاه) را با مقادیر عددی معتبر (بزرگتر از صفر) پر کنید.');
                return;
            }

            // --- محاسبات ---
            // 1. محاسبه نیاز نهایی به عنصر از کود (ppm)
            const finalNReq = Math.max(0, reqN - waterN);
            const finalPReq = Math.max(0, reqP - waterP);
            const finalKReq = Math.max(0, reqK - waterK);
            const finalCaReq = Math.max(0, reqCa - waterCa);
            const finalMgReq = Math.max(0, reqMg - waterMg);

            // 2. محاسبه مقدار کود مورد نیاز (گرم/لیتر یا گرم/متر مربع)
            // 1 ppm = 1 mg/Liter. پس گرم کود = (ppm مورد نیاز * حجم مخزن) / درصد خلوص عنصر در کود * 10
            let effectiveVolume = solutionVolume;
            let unitText = 'لیتر';
            if (calculationUnit === 'area') {
                effectiveVolume = solutionVolume * 10; // فرض 10 لیتر آب برای هر متر مربع
                unitText = 'متر مربع (بر اساس 10 لیتر آب/متر مربع)';
            }

            // یک منطق ساده برای توزیع نیازها بین کودها (این بخش می‌تواند بسیار پیچیده‌تر شود)
            // این مدل ساده برای نشان دادن نحوه کار است و نیاز به توسعه دارد.
            let fert1Grams = 0;
            let fert2Grams = 0;

            if (finalKReq > 0 && fert1K > 0) {
                fert1Grams = (finalKReq * effectiveVolume) / (fert1K * 10);
            } else if (finalNReq > 0 && fert1N > 0) { // اگر K نیست، N را بررسی کن
                fert1Grams = (finalNReq * effectiveVolume) / (fert1N * 10);
            } else if (finalPReq > 0 && fert1P > 0) { // اگر N هم نیست، P را بررسی کن
                 fert1Grams = (finalPReq * effectiveVolume) / (fert1P * 10);
            }

            if (finalCaReq > 0 && fert2Ca > 0) {
                fert2Grams = (finalCaReq * effectiveVolume) / (fert2Ca * 10);
            } else if (finalNReq > 0 && fert2N > 0) { // اگر Ca نیست، N را بررسی کن
                 fert2Grams = (finalNReq * effectiveVolume) / (fert2N * 10);
            } else if (finalKReq > 0 && fert2K > 0) { // اگر N هم نیست، K را بررسی کن
                fert2Grams = (finalKReq * effectiveVolume) / (fert2K * 10);
            }


            // --- نمایش نتایج ---
            document.getElementById('displayCropType').textContent = cropType;
            document.getElementById('displayGrowthStage').textContent = growthStage;
            document.getElementById('displaySolutionVolume').textContent = solutionVolume.toLocaleString('fa-IR');
            document.getElementById('displayCalculationUnit').textContent = calculationUnitDisplayName;
            document.getElementById('displayUnitText').textContent = unitText;

            document.getElementById('resNReq').textContent = reqN.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resNWater').textContent = waterN.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resNFinal').textContent = finalNReq.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            document.getElementById('resPReq').textContent = reqP.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resPWater').textContent = waterP.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resPFinal').textContent = finalPReq.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            document.getElementById('resKReq').textContent = reqK.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resKWater').textContent = waterK.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resKFinal').textContent = finalKReq.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            document.getElementById('resCaReq').textContent = reqCa.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resCaWater').textContent = waterCa.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resCaFinal').textContent = finalCaReq.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            document.getElementById('resMgReq').textContent = reqMg.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resMgWater').textContent = waterMg.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('resMgFinal').textContent = finalMgReq.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            document.getElementById('fert1Dosage').innerHTML = `**${fert1Name}:** ${fert1Grams.toLocaleString('fa-IR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} گرم`;
            document.getElementById('fert2Dosage').innerHTML = `**${fert2Name}:** ${fert2Grams.toLocaleString('fa-IR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} گرم`;
        });
  </script>
</body>
</html>
